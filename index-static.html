<html>
  <meta charset="UTF-8"/>
  <base href="/"/>
  <link type="text/css" href="/style.css" rel="stylesheet"/>

  <!-- editor scripts -->
  <script type="text/javascript" src="jquery.min.js"></script>
  <script type="text/javascript" src="touched.js"></script>
  <script type="text/javascript" src="touched-types.js"></script>
  <script type="text/javascript" src="touched-menu.js"></script>
  <script type="text/javascript" src="touched-tocode.js"></script>

  <!-- execution scripts -->
  <script type="text/javascript" src="d3.v2.js"></script>
  <script type="text/javascript" src="exec.js"></script>
  <script type="text/javascript" src="exec.d3.js"></script>
  <script type="text/javascript" src="exec.viz.js"></script>
  <style>
    #updateswitch {
      float: right;
    }
    #dataview table,td {
      border-collapse: collapse;
      border: 1px black solid
    }
  </style>
  <script language="javascript">
      $(function() {
        $('#canvas').bind('update', function() { saveContent(); runContent(); });
        $('#autoupdate').bind('change', runContent);
        loadGrammarFile("<touched:g>");
      });
      function saveContent() {
          var content = $('#canvas').html();
          var http = new XMLHttpRequest();
          http.onreadystatechange = function() { 
             if (http.readyState==4 && http.status!=200) 
                 $('#menu').html('<b>Error saving document</b>');
          };
          http.open("POST", "/save/<touched:file>?code=<touched:code>", true);
          http.send(content);
      }
      function runContent() {
          if ($('#autoupdate').attr('checked')) {
             $('#dataview').show();
	     execute();
	  } else {
	     $('#dataview').hide();
	  }
      }
  </script>
  <body>
    <div id="menubar">
      <ul id="menu"/>
    </div>
    <div style="height:50px">Touched Editor</div>
    <div id="canvas"><touched:content></div>
    <span id="updateswitch">
      <input type='checkbox' id="autoupdate"/> Run
    </span>
    <div id="dataview"/>
  </body>
</html>
